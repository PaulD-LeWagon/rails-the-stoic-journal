<%= simple_form_for(
  task,
  html: {
    id: "#{ dom_id task }",
    class: "card task task-form m-3 p-2"
  },
  data: {
    controller: "cards",
    action: "submit->cards#submit",
    form_target: "form"
  }) do |f| %>

  <%= f.error_notification %>
  <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>

  <div class="form-inputs">

    <%= f.input :order, input_html: { class: "order" }, label: false %>

    <%= f.input :routine, collection: Task::transform_routines_for_html_select, input_html: { class: "form-control mb-3" } %>

    <%= f.input :recurs_on, as: :check_boxes, input_html: { class: "form-control mb-3" } %>

    <%= f.input :task_type, collection: Task::transform_task_types_for_html_select, input_html: { class: "form-control mb-3" } %>

    <%= f.input :title, input_html: { class: "form-control mb-3" } %>

    <%= f.input :description, as: :text, input_html: { class: "form-control mb-3", 'rows' => 5, 'cols' => 10 } %>

    <%= f.input :comment, as: :text, input_html: { class: "form-control mb-3", 'rows' => 5, 'cols' => 10 } %>

    <%= f.input :start_date, html5: true, input_html: { class: "form-control mb-3" } %>

    <%= f.input :due_date, html5: true, input_html: { class: "form-control mb-3" } %>

    <%= f.input :completed, as: :boolean, input_html: { id: "#{dom_id task}_completed", class: "form-control mb-3" } %>

    <%= f.input :active, as: :boolean, input_html: { class: "form-control mb-3" } %>

  </div>

  <h3>Sub Tasks</h3>
  <div class="subtasks-controller">

    <div id="sub_tasks_for_<%= dom_id task %>">

    <%= f.simple_fields_for :sub_tasks do |sub_task| %>

      <%= render "sub_task_fields", f: sub_task %>

    <% end %>

    </div>

    <div class="links">

      <%= link_to_add_nested(
        f,
        :sub_tasks,
        "#sub_tasks_for_#{ dom_id task }",
        partial_form_variable: :f,
        tag_attributes: {
          class: "Add-nested-assoc",
          title: "Add a subtask"
        },
        link_classes: 'btn btn-sm btn-primary m-1'
      ) do %>

        <i class='fa fa-square-plus'></i>

      <% end %>

    </div>
  </div>

  <div class="form-actions links d-flex justify-content-end align-items-center">

    <%= render 'links', task: task %>

    <%= button_tag type: 'submit', class: "btn btn-primary" do %>

      <i class="fa-solid fa-thumbs-up"></i>

    <% end %>

  </div>

<% end %>
